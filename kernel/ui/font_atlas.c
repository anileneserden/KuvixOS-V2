#include <kernel/drivers/video/gfx.h>
#include <kernel/drivers/video/fb.h>
#include <stdint.h>

// Tüm harflerin olduğu güncel font dizisi
static uint8_t test_font[256][16] = {
    // --- KÜÇÜK HARFLER ---
    ['a'] = {0x00,0x00,0x00,0x00,0x78,0x0C,0x7C,0xCC,0xCC,0xCC,0x76,0x00,0x00,0x00,0x00,0x00},
    ['b'] = {0x00,0x00,0xC0,0xC0,0xDC,0xE6,0xC6,0xC6,0xC6,0xE6,0xDC,0x00,0x00,0x00,0x00,0x00},
    ['c'] = {0x00,0x00,0x00,0x00,0x78,0xCC,0xC0,0xC0,0xC0,0xCC,0x78,0x00,0x00,0x00,0x00,0x00},
    [0xE7] = {0x00,0x00,0x00,0x00,0x78,0xCC,0xC0,0xC0,0xCC,0x78,0x10,0x30,0x00,0x00,0x00,0x00}, // ç
    ['d'] = {0x00,0x00,0x06,0x06,0x76,0xCC,0xCC,0xCC,0xCC,0xCE,0x77,0x00,0x00,0x00,0x00,0x00},
    ['e'] = {0x00,0x00,0x00,0x00,0x78,0xCC,0xFC,0xC0,0xC0,0xCC,0x78,0x00,0x00,0x00,0x00,0x00},
    ['f'] = {0x00,0x00,0x1C,0x36,0x30,0x78,0x30,0x30,0x30,0x30,0x78,0x00,0x00,0x00,0x00,0x00},
    ['g'] = {0x00,0x00,0x00,0x00,0x76,0xCC,0xCC,0xCC,0xCC,0x7C,0x0C,0x1C,0x78,0x00,0x00,0x00},
    [0xF0] = {0x78,0x00,0x00,0x00,0x76,0xCC,0xCC,0xCC,0xCC,0x7C,0x0C,0x1C,0x78,0x00,0x00,0x00}, // ğ
    ['h'] = {0x00,0x00,0xC0,0xC0,0xD8,0x6C,0x66,0x66,0x66,0x66,0x66,0x00,0x00,0x00,0x00,0x00},
    [0xFD] = {0x00,0x00,0x00,0x00,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x00,0x00,0x00,0x00,0x00}, // ı
    ['i'] = {0x00,0x30,0x00,0x00,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x00,0x00,0x00,0x00,0x00},
    ['j'] = {0x00,0x30,0x00,0x00,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x60,0xC0,0x78,0x00},
    ['k'] = {0x00,0x00,0xC0,0xC0,0xCC,0xD8,0xF0,0xE0,0xD0,0xD8,0xCC,0x00,0x00,0x00,0x00,0x00},
    ['l'] = {0x00,0x00,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x1C,0x00,0x00,0x00,0x00,0x00},
    ['m'] = {0x00,0x00,0x00,0x00,0xD6,0xFE,0xEE,0xD6,0xD6,0xD6,0xD6,0x00,0x00,0x00,0x00,0x00}, // Düzenlendi
    ['n'] = {0x00,0x00,0x00,0x00,0xDC,0x66,0x66,0x66,0x66,0x66,0x66,0x00,0x00,0x00,0x00,0x00},
    ['o'] = {0x00,0x00,0x00,0x00,0x78,0xCC,0xCC,0xCC,0xCC,0xCC,0x78,0x00,0x00,0x00,0x00,0x00},
    [0xF6] = {0x6C,0x00,0x00,0x00,0x78,0xCC,0xCC,0xCC,0xCC,0xCC,0x78,0x00,0x00,0x00,0x00,0x00}, // ö
    ['p'] = {0x00,0x00,0x00,0x00,0xDC,0x66,0x66,0x66,0x66,0x7C,0x60,0x60,0xF0,0x00,0x00,0x00},
    ['r'] = {0x00,0x00,0x00,0x00,0xDE,0x76,0x60,0x60,0x60,0x60,0xF0,0x00,0x00,0x00,0x00,0x00},
    ['s'] = {0x00,0x00,0x00,0x00,0x7C,0xC6,0x60,0x38,0x0C,0xC6,0x7C,0x00,0x00,0x00,0x00,0x00},
    [0xFE] = {0x00,0x00,0x00,0x00,0x7C,0xC6,0x60,0x38,0x0C,0xC6,0x7C,0x10,0x30,0x00,0x00,0x00}, // ş
    ['t'] = {0x00,0x00,0x30,0x30,0xFC,0x30,0x30,0x30,0x30,0x36,0x1C,0x00,0x00,0x00,0x00,0x00},
    ['u'] = {0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x66,0x3E,0x00,0x00,0x00,0x00,0x00},
    [0xFC] = {0x66,0x00,0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x66,0x3E,0x00,0x00,0x00,0x00,0x00}, // ü
    ['v'] = {0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x3C,0x18,0x00,0x00,0x00,0x00,0x00},
    ['y'] = {0x00,0x00,0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x3E,0x06,0x0C,0xF8,0x00,0x00,0x00},
    ['z'] = {0x00,0x00,0x00,0x00,0xFE,0x0C,0x18,0x30,0x60,0xC0,0xFE,0x00,0x00,0x00,0x00,0x00},

    // --- BÜYÜK HARFLER ---
    ['A'] = {0x10,0x38,0x6C,0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0xC6,0x00,0x00,0x00,0x00,0x00,0x00}, // Yukarı çekildi
    ['B'] = {0x00,0x00,0xFC,0x66,0x66,0x7C,0x66,0x66,0x66,0xFC,0x00,0x00,0x00,0x00,0x00,0x00},
    ['C'] = {0x00,0x00,0x3C,0x66,0xC0,0xC0,0xC0,0xC0,0x66,0x3C,0x00,0x00,0x00,0x00,0x00,0x00},
    [0xC7] = {
        0x00, 0x00,       // Üst boşluk
        0x3C, 0x66, 0xC0, 0xC0, 0xC0, 0xC0, 0x66, 0x3C, // C Gövdesi (2-9. satırlar)
        0x10,             // Çengel başı (10. satır)
        0x30,             // Çengel gövdesi (11. satır)
        0x10,             // Çengel sonu (12. satır)
        0x00, 0x00, 0x00
    },
    ['D'] = {0x00,0x00,0xF8,0x6C,0x66,0x66,0x66,0x66,0x6C,0xF8,0x00,0x00,0x00,0x00,0x00,0x00},
    ['E'] = {0x00,0x00,0xFE,0x62,0x60,0x7C,0x60,0x60,0x62,0xFE,0x00,0x00,0x00,0x00,0x00,0x00},
    ['F'] = {0x00,0x00,0xFE,0x62,0x60,0x7C,0x60,0x60,0x60,0xF0,0x00,0x00,0x00,0x00,0x00,0x00},
    ['G'] = {0x00,0x00,0x3E,0x66,0xC0,0xCE,0xC6,0xC6,0x66,0x3E,0x00,0x00,0x00,0x00,0x00,0x00},
    [0xD0] = {0x7E,0x00,0x3E,0x66,0xC0,0xCE,0xC6,0xC6,0x66,0x3E,0x00,0x00,0x00,0x00,0x00,0x00}, // Ğ (Gövde G ile aynı, şapka üstte)
    ['H'] = {0x00,0x00,0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0xC6,0x00,0x00,0x00,0x00,0x00,0x00},
    ['I'] = {0x00,0x00,0x7E,0x18,0x18,0x18,0x18,0x18,0x18,0x7E,0x00,0x00,0x00,0x00,0x00,0x00},
    [0xDD] = {0x18,0x00,0x7E,0x18,0x18,0x18,0x18,0x18,0x18,0x7E,0x00,0x00,0x00,0x00,0x00,0x00}, // İ (Nokta en üstte)
    ['J'] = {0x00,0x00,0x1E,0x0C,0x0C,0x0C,0x0C,0xCC,0xCC,0x78,0x00,0x00,0x00,0x00,0x00,0x00},
    ['K'] = {0x00,0x00,0xC6,0xCC,0xD8,0xF0,0xE0,0xD8,0xCC,0xC6,0x00,0x00,0x00,0x00,0x00,0x00},
    ['L'] = {0x00,0x00,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC2,0xFE,0x00,0x00,0x00,0x00,0x00,0x00},
    ['M'] = {0x00,0x00,0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0xC6,0xC6,0x00,0x00,0x00,0x00,0x00,0x00},
    ['N'] = {0x00,0x00,0xC6,0xE6,0xF6,0xDE,0xCE,0xC6,0xC6,0xC6,0x00,0x00,0x00,0x00,0x00,0x00},
    ['O'] = {0x00,0x00,0x3C,0x66,0xC6,0xC6,0xC6,0xC6,0x66,0x3C,0x00,0x00,0x00,0x00,0x00,0x00},
    [0xD6] = {0x6C,0x00,0x3C,0x66,0xC6,0xC6,0xC6,0xC6,0x66,0x3C,0x00,0x00,0x00,0x00,0x00,0x00}, // Ö
    ['P'] = {0x00,0x00,0xFC,0x66,0x66,0x7C,0x60,0x60,0x60,0xF0,0x00,0x00,0x00,0x00,0x00,0x00},
    ['R'] = {0x00,0x00,0xFC,0x66,0x66,0x7C,0x70,0x68,0x66,0xE6,0x00,0x00,0x00,0x00,0x00,0x00},
    ['S'] = {0x00,0x00,0x3E,0x66,0x60,0x3C,0x06,0x66,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    [0xDE] = {
        0x00, 0x00,       // Üst boşluk
        0x3E, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3E, // S Gövdesi (2-8. satırlar)
        0x00,             // Gövde altı boşluk (9. satır)
        0x10,             // Çengel başı (10. satır)
        0x30,             // Çengel gövdesi (11. satır)
        0x10,             // Çengel sonu (12. satır)
        0x00, 0x00, 0x00
    }, // Ş (S gövdesi yukarı, çengel aşağı)
    ['T'] = {0x00,0x00,0xFE,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00,0x00,0x00,0x00},
    ['U'] = {0x00,0x00,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x66,0x3C,0x00,0x00,0x00,0x00,0x00,0x00},
    [0xDC] = {0x6C,0x00,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x66,0x3C,0x00,0x00,0x00,0x00,0x00,0x00}, // Ü
    ['V'] = {0x00,0x00,0xC6,0xC6,0xC6,0xC6,0xC6,0x66,0x3C,0x18,0x00,0x00,0x00,0x00,0x00,0x00},
    ['Y'] = {0x00,0x00,0xC6,0xC6,0x66,0x3C,0x18,0x18,0x18,0x3C,0x00,0x00,0x00,0x00,0x00,0x00},
    ['Z'] = {0x00,0x00,0xFE,0xC6,0x0C,0x18,0x30,0x60,0xC6,0xFE,0x00,0x00,0x00,0x00,0x00,0x00},
};

void ui_show_font_atlas() {
    fb_clear(0xFF222222); // Arka plan

    // 1. KÜÇÜK HARF DİZİSİ (ISO-8859-9 / Latin-5)
    uint8_t kucukler[] = { 
        'a', 'b', 'c', 0xE7, 'd', 'e', 'f', 'g', 0xF0, 'h', 
        0xFD, 'i', 'j', 'k', 'l', 'm', 'n', 'o', 0xF6, 'p', 
        'r', 's', 0xFE, 't', 'u', 0xFC, 'v', 'y', 'z', 0 
    };

    // 2. BÜYÜK HARF DİZİSİ (ISO-8859-9 / Latin-5)
    // Not: Büyük İ için 0xDD kullandık (Dizi sınırını aşmamak için en güvenli yol)
    uint8_t buyukler[] = { 
        'A', 'B', 'C', 0xC7, 'D', 'E', 'F', 'G', 0xD0, 'H', 
        'I', 0xDD, 'J', 'K', 'L', 'M', 'N', 'O', 0xD6, 'P', 
        'R', 'S', 0xDE, 'T', 'U', 0xDC, 'V', 'Y', 'Z', 0 
    };

    int startX = 20;
    int spacing = 10; // Harfler arası 10 piksel (8 harf + 2 boşluk) daha ferah durur
    uint32_t beyaz = 0xFFFFFFFF;
    uint32_t sari = 0xFFFFFF00;

    // KÜÇÜKLERİ ÇİZ (Y: 100)
    for (int i = 0; kucukler[i] != 0; i++) {
        uint8_t c = kucukler[i];
        for (int row = 0; row < 16; row++) {
            uint8_t bits = test_font[c][row];
            for (int col = 0; col < 8; col++) {
                if (bits & (0x80 >> col)) {
                    fb_putpixel(startX + (i * spacing) + col, 100 + row, beyaz);
                }
            }
        }
    }

    // BÜYÜKLERİ ÇİZ (Y: 130)
    for (int i = 0; buyukler[i] != 0; i++) {
        uint8_t c = buyukler[i];
        for (int row = 0; row < 16; row++) {
            uint8_t bits = test_font[c][row];
            for (int col = 0; col < 8; col++) {
                if (bits & (0x80 >> col)) {
                    fb_putpixel(startX + (i * spacing) + col, 130 + row, sari);
                }
            }
        }
    }

    fb_present();
}